<!-- <div *ngIf="isDeleteMode" class="overlay">
    <div class="modal">
        <p>{{ pendingDeletions.length + standaloneDeletions.length }} widgets marked for deletion.</p>
        <button mat-button (click)="finalizeDeletions()">Confirm Deletions</button>
        <button mat-button (click)="undoDeletions()">Undo</button>
    </div>
</div> -->



<div class="main-container gridster-container">
    <div class="help-button-container">
        <a id="help-button">
            <button class="btnAdd" mat-raised-button [matMenuTriggerFor]="mainMenu">Quick Actions</button>
            <mat-menu #mainMenu="matMenu" yPosition="above">
                <button mat-menu-item (click)="openSidePanel()">Add a Widget</button>
                <button mat-menu-item (click)="toggleDeleteMode()">Delete a Widget</button>
                <!-- <button mat-menu-item routerLink="/help">Help</button>
                <button mat-menu-item routerLink="/settings">Settings</button> -->
            </mat-menu>
        </a>
    </div>
    <mat-sidenav-container class="sidenav-container">
        <mat-sidenav #sidenav mode="side" opened="false" position="end" style="width: 25%;padding: 19px;">
            <div class="sidenav-header">
                <h3>Select Widget</h3>
                <button mat-icon-button (click)="closeSidePanel()">
                    <mat-icon>close</mat-icon>
                </button>
            </div>
            <div class="charts-container">
                <!-- Add more chart previews as needed -->
                <div *ngFor="let config of chartConfigs">
                    <app-templatechart [chartType]="config.type" [chartData]="config.data" [chartTitle]="config.title"
                        (chartSelected)="openCustomizeModal($event)"></app-templatechart>
                </div>

            </div>
        </mat-sidenav>
        <mat-sidenav-content>
            <!-- Your main dashboard content here -->
            <!-- <gridster [options]="options"> -->
            <!-- <gridster-item [item]="item" *ngFor="let item of dashboard"> -->
            <!-- <ng-container *ngIf="item.type === 'chart'"> -->
            <!-- You'll need to create a component that can render different chart types -->
            <!-- <app-templatechart></app-templatechart> -->
            <!-- </ng-container> -->
            <!-- Other gridster items -->
            <!-- </gridster-item> -->
            <!-- </gridster> -->
        </mat-sidenav-content>
    </mat-sidenav-container>

    <gridster [options]="options">
        <gridster-item [item]="item" *ngFor="let item of dashboard">
            <!-- Use ngSwitch to differentiate between card types -->
            <div [ngSwitch]="item.type" [class.blur]="isDeleteMode && !pendingDeletions.includes(item)"
                *ngIf="item.isActive">
                <!-- Normal Cards -->
                <div *ngSwitchCase="'card'" class="card" [ngClass]="{ orders: item.name === 'Orders' }">
                    <button *ngIf="isDeleteMode" mat-mini-fab color="warn" class="delete-icon"
                        (click)="markForDeletion(item, $event)">
                        <mat-icon>delete_outline</mat-icon>
                    </button>
                    <div class="icon-container">
                        <mat-icon class="icon" [matTooltip]="item.tooltip ?? 'No description available'"
                            matTooltipPosition="above">{{ item.icon }}</mat-icon>
                    </div>
                    <div class="text-content">
                        <h4>{{ item.name }}</h4>
                        <p class="analytic">{{ item.analytic }}</p>
                    </div>
                    <div class="percentage"
                        [ngClass]="{ increase: (item.percentage ?? 0) > 0, decrease: (item.percentage ?? 0) < 0 }">
                        {{ item.percentage }}<span>%</span>
                    </div>
                </div>
            </div>
            <ng-container *ngIf="item.type === 'chart'" [class.blur]="isDeleteMode && !pendingDeletions.includes(item)">
                <button *ngIf="isDeleteMode" mat-mini-fab color="warn" class="delete-icon"
                    (click)="markForDeletion(item, $event)">
                    <mat-icon>delete_outline</mat-icon>
                </button>
                <ng-container *ngComponentOutlet="item.component"></ng-container>
            </ng-container>
        </gridster-item>
        <gridster-item *ngIf="largeItem.isActive" [item]="largeItem">
            <button *ngIf="isDeleteMode" mat-mini-fab color="warn" class="delete-icon"
                (click)="markForDeletion(largeItem, $event)">
                <mat-icon>delete_outline</mat-icon>
            </button>
            <div class="full-width-card">
                <div class="statistics" style="width: 50%; padding: 20px">
                    <div class="earnings">
                        <h3 style="color: var(----dash-bg-color); margin-bottom: 10px">Requests</h3>
                        <ul style="list-style: none; padding: 0; margin: 0">
                            <li *ngIf="RequestOrders" style="padding: 8px 0; border-bottom: 1px solid #eee">
                                Total Requests: {{ RequestOrders.requests.totalRequests }}
                            </li>
                            <li *ngIf="RequestOrders" style="padding: 8px 0; border-bottom: 1px solid #eee">
                                Most Requested Category: {{ RequestOrders.requests.mostRequested.name }}
                                ({{ RequestOrders.requests.mostRequested.percentage }}%)
                            </li>
                            <li *ngIf="RequestOrders" style="padding: 8px 0">
                                Highest Requests: {{ RequestOrders.requests.highestRequest }}
                            </li>
                        </ul>
                    </div>
                    <hr />
                    <div class="earnings">
                        <h3 style="color: var(----dash-bg-color); margin-bottom: 10px">Backorders</h3>
                        <ul style="list-style: none; padding: 0; margin: 0">
                            <li *ngIf="RequestOrders" style="padding: 8px 0; border-bottom: 1px solid #eee">
                                Current Backorders: {{ RequestOrders.backorders.currentBackorders }}
                            </li>
                            <li *ngIf="RequestOrders" style="padding: 8px 0; border-bottom: 1px solid #eee">
                                Average Delay: {{ RequestOrders.backorders.averageDelay }} days
                            </li>
                            <li *ngIf="RequestOrders" style="padding: 8px 0">
                                Longest Backorder Item: {{ RequestOrders.backorders.longestBackorderItem.productName }}
                                -
                                {{ RequestOrders.backorders.longestBackorderItem.delay }} days
                            </li>
                        </ul>
                    </div>
                </div>

                <app-saleschart class="chart"></app-saleschart>
            </div>
        </gridster-item>
        <gridster-item *ngIf="newLargeItem.isActive" [item]="newLargeItem">
            <button *ngIf="isDeleteMode" mat-mini-fab color="warn" class="delete-icon"
                (click)="markForDeletion(newLargeItem, $event)">
                <mat-icon>delete_outline</mat-icon>
            </button>
            <div class="new-full-width-card">
                <app-barchart class="chart-section"></app-barchart>
                <div class="info-section">
                    <h3>Want full report?</h3>
                    <p>Awesome! You can see more detailed information and download it using this option.</p>
                    <button class="report-btn" routerLink="/reports">See reports</button>
                </div>
            </div>
        </gridster-item>
        <gridster-item *ngIf="SalesvsTarget.isActive" [item]="SalesvsTarget">
            <button *ngIf="isDeleteMode" mat-mini-fab color="warn" class="delete-icon"
                (click)="markForDeletion(SalesvsTarget, $event)">
                <mat-icon>delete_outline</mat-icon>
            </button>
            <app-bubblechart></app-bubblechart>
        </gridster-item>
        <gridster-item *ngIf="Product.isActive" [item]="Product">
            <button *ngIf="isDeleteMode" mat-mini-fab color="warn" class="delete-icon"
                (click)="markForDeletion(Product, $event)">
                <mat-icon>delete_outline</mat-icon>
            </button>
            <app-donutchart></app-donutchart>
        </gridster-item>
    </gridster>
    <div *ngFor="let config of newCharts">
        <app-templatechart [chartType]="config.chartType" [chartData]="config.data" [chartTitle]="config.title"
            style="width: 400px; height: 400px;"></app-templatechart>
    </div>
</div>